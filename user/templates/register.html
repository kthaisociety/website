{% extends "base.html" %}
{% load app_tags %}
{% load bootstrap4 %}
{% load i18n %}

{% block head_title %}{% if request.user.is_authenticated %}Finish registering{% else %}Register{% endif %}{% endblock %}

{% block body %}
    <div class="container py-5">
        <div class="row">
            <div class="col-md-12 text-center">
                {% if request.user.is_authenticated %}
                    <h1>Finish registering</h1>
                {% else %}
                    <h1>Register</h1>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                {% if request.user.is_authenticated and not request.user.email_verified %}
                    <p class="mt-3">Please confirm your email to finish the registration.</p>
                {% else %}
                    <form action="" method="post" class="form">
                        {% csrf_token %}
                        {% if request.user.is_authenticated %}
                            <p class="mt-3">Please finish entering the following details to finish your subscription.</p>
                        {% endif %}
                        <div class="form-group">
                            <label for="id_name">First name <small>(required)</small></label>
                            <input type="text" name="name" maxlength="225" class="form-control" placeholder="Daniel" id="id_name" {% if request.user.name %}value="{{ request.user.name }}"{% endif %}>
                        </div>
                        <div class="form-group">
                            <label for="id_surname">Last name <small>(required)</small></label>
                            <input type="text" name="surname" maxlength="225" class="form-control" placeholder="Stenberg" id="id_surname" {% if request.user.surname %}value="{{ request.user.surname }}"{% endif %}>
                        </div>
                        {% if not request.user.email_verified %}
                            <div class="form-group">
                                <label for="id_email">Email <small>(required)</small></label>
                                <input type="email" name="email" maxlength="225" class="form-control" placeholder="curl@kthais.com" id="id_email">
                            </div>
                            <div class="form-group">
                                <label for="id_password">Password <small>(required)</small></label>
                                <input type="password" name="password" maxlength="225" class="form-control" placeholder="****************" id="id_password">
                            </div>
                            <div class="form-group">
                                <label for="id_password2">Repeat password <small>(required)</small></label>
                                <input type="password" name="password2" maxlength="225" class="form-control" placeholder="****************" id="id_password2">
                            </div>
                        {% endif %}
                        <div class="form-row mt-3">
                            <div class="col-md-4">
                                <label for="id_university">University <small>(required)</small></label>
                                <input type="text" name="university" maxlength="225" class="form-control" placeholder="Kungliga Tekniska Högskolan" id="id_university">
                            </div>
                            <div class="col-md-4">
                                <label for="id_degree">Programme <small>(required)</small></label>
                                <input type="text" name="degree" maxlength="225" class="form-control" placeholder="Computer Science" id="id_degree">
                            </div>
                            <div class="col-md-4">
                                <label for="id_graduation">Graduation year <small>(required)</small></label>
                                <select name="graduation" class="form-control" id="id_Graduation">
                                    {% for i in "01234567"|make_list %}
                                        {% with forloop.counter0|add:"-2"|year_from_now as year %}
                                            <option value="{{ year }}" {% if forloop.counter0 == 2 %}selected=""{% endif %}>{{ year }}</option>
                                        {% endwith %}
                                    {% endfor %}
                                    <option value="0">Other</option>
                                </select>
                            </div>
                        </div>
                        <p class="mt-3">Please note the following information is only for demographic and statistic purposes.</p>
                        <div class="form-row">
                            <div class="col-md-6">
                                <label for="id_birthday">Birthday</label>
                                <input type="date" name="birthday" class="form-control" placeholder="1986-09-17" id="id_birthday">
                            </div>
                            <div class="col-md-6">
                                <label for="id_sex">Sex</label>
                                <select name="sex" class="form-control" id="id_sex">
                                    <option selected="" disabled>―</option>
                                    <option value="0">Prefer not to say</option>
                                    <option value="1">Female</option>
                                    <option value="2">Male</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row mt-3">
                            <div class="col-md-6">
                                <label for="id_city">City</label>
                                <input type="text" name="city" maxlength="225" class="form-control" placeholder="Stockholm" id="id_city">
                            </div>
                            <div class="col-md-6">
                                <label for="id_country">Country</label>
                                <input type="text" name="country" maxlength="225" class="form-control" placeholder="Sweden" id="id_country">
                            </div>
                        </div>
                        <div class="form-group mt-3">
                            <input type="checkbox" name="terms" class="mr-1 form-check-inline" id="id_terms" required="">
                            <label for="id_terms">I've read, understand and accept the <a href="{% url 'page_page' 'legal' 'terms-and-conditions' %}" class="link-colour" target="_blank">Terms & Conditions</a> and the <a href="{% url 'page_page' 'legal' 'privacy-and-cookies' %}" class="link-colour" target="_blank">Privacy and Cookies Policy</a>.</label>
                        </div>
                        <div class="form-group text-center mt-4">
                            {% if request.user.is_authenticated %}
                                <button class="btn btn-main" type="submit">Save</button>
                            {% else %}
                                <button class="btn btn-main" type="submit">Register</button>
                                <a class="link-unstyled" href="{% url "social:begin" "google-oauth2" %}">
                                    <button type="button" class="btn btn-main2 ml-2">Register with Google <i class="fab fa-google ml-1"></i></button>
                                </a>
                            {% endif %}
                        </div>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        window.onload = function() {
            const password = document.getElementById("id_password");
            password.onpaste = function(e) {
                e.preventDefault();
            };
            const password2 = document.getElementById("id_password2");
            password2.onpaste = function(e) {
                e.preventDefault();
            };
        }
    </script>
{% endblock %}
